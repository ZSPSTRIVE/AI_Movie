<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>API æµ‹è¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; white-space: pre-wrap; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        h2 { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ¬ æœå†»å½±é™¢ API æµ‹è¯•</h1>
    
    <h2>1. æµ‹è¯•ç”µå½±æ¨è API</h2>
    <button onclick="testFilmRecommend()">æµ‹è¯• /api/film/recommend/feed</button>
    <div id="result1" class="result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</div>
    
    <h2>2. æµ‹è¯•åˆ†ç±»åˆ—è¡¨ API</h2>
    <button onclick="testCategoryList()">æµ‹è¯• /api/film/category/list</button>
    <div id="result2" class="result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</div>
    
    <h2>3. æµ‹è¯•å¸–å­åˆ—è¡¨ API</h2>
    <button onclick="testPostList()">æµ‹è¯• /api/post/list</button>
    <div id="result3" class="result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</div>
    
    <h2>4. ç›´æ¥æµ‹è¯• Gateway</h2>
    <button onclick="testGateway()">ç›´æ¥è®¿é—® localhost:8080</button>
    <div id="result4" class="result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</div>

    <h2>5. æµ‹è¯•ç™»å½•</h2>
    <div>
        <input id="username" placeholder="ç”¨æˆ·å" value="test123">
        <input id="password" placeholder="å¯†ç " value="123456">
        <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
    </div>
    <div id="result5" class="result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•ç™»å½•...</div>
    
    <h2>6. ç™»å½•åæµ‹è¯• API</h2>
    <button onclick="testWithToken()">å¸¦ Token è¯·æ±‚ /api/film/category/list</button>
    <div id="result6" class="result">å…ˆç™»å½•ï¼Œå†æµ‹è¯•...</div>

    <h2>7. æ¸…é™¤æœ¬åœ°å­˜å‚¨</h2>
    <button onclick="clearStorage()">æ¸…é™¤æ‰€æœ‰ç¼“å­˜</button>
    <div id="result7" class="result">ç‚¹å‡»æŒ‰é’®æ¸…é™¤...</div>

    <script>
        let savedToken = null;
        
        async function testLogin() {
            const el = document.getElementById('result5');
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            try {
                const res = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await res.json();
                if (data.code === 200) {
                    savedToken = data.data.token;
                    el.className = 'result success';
                    el.textContent = 'âœ… ç™»å½•æˆåŠŸ!\nToken: ' + savedToken + '\n\nå®Œæ•´å“åº”:\n' + JSON.stringify(data, null, 2);
                } else {
                    el.className = 'result error';
                    el.textContent = 'âŒ ç™»å½•å¤±è´¥: ' + data.msg;
                }
            } catch (e) {
                el.className = 'result error';
                el.textContent = 'âŒ è¯·æ±‚å¤±è´¥: ' + e.message;
            }
        }
        
        async function testWithToken() {
            const el = document.getElementById('result6');
            if (!savedToken) {
                el.className = 'result error';
                el.textContent = 'âŒ è¯·å…ˆç™»å½•è·å– Token';
                return;
            }
            try {
                const res = await fetch('/api/film/category/list', {
                    headers: { 'Authorization': savedToken }
                });
                const data = await res.json();
                el.className = data.code === 200 ? 'result success' : 'result error';
                el.textContent = (data.code === 200 ? 'âœ… æˆåŠŸ!' : 'âŒ å¤±è´¥!') + '\n' + JSON.stringify(data, null, 2);
            } catch (e) {
                el.className = 'result error';
                el.textContent = 'âŒ è¯·æ±‚å¤±è´¥: ' + e.message;
            }
        }
        async function testFilmRecommend() {
            const el = document.getElementById('result1');
            try {
                const res = await fetch('/api/film/recommend/feed?size=3');
                const data = await res.json();
                el.className = 'result success';
                el.textContent = 'âœ… æˆåŠŸ!\n' + JSON.stringify(data, null, 2);
            } catch (e) {
                el.className = 'result error';
                el.textContent = 'âŒ å¤±è´¥: ' + e.message;
            }
        }
        
        async function testCategoryList() {
            const el = document.getElementById('result2');
            try {
                const res = await fetch('/api/film/category/list');
                const data = await res.json();
                el.className = 'result success';
                el.textContent = 'âœ… æˆåŠŸ!\n' + JSON.stringify(data, null, 2);
            } catch (e) {
                el.className = 'result error';
                el.textContent = 'âŒ å¤±è´¥: ' + e.message;
            }
        }
        
        async function testPostList() {
            const el = document.getElementById('result3');
            try {
                const res = await fetch('/api/post/list?pageNum=1&pageSize=5');
                const data = await res.json();
                el.className = 'result success';
                el.textContent = 'âœ… æˆåŠŸ!\n' + JSON.stringify(data, null, 2);
            } catch (e) {
                el.className = 'result error';
                el.textContent = 'âŒ å¤±è´¥: ' + e.message;
            }
        }
        
        async function testGateway() {
            const el = document.getElementById('result4');
            try {
                const res = await fetch('http://localhost:8080/film/recommend/feed?size=3');
                const data = await res.json();
                el.className = 'result success';
                el.textContent = 'âœ… Gateway ç›´æ¥è®¿é—®æˆåŠŸ!\n' + JSON.stringify(data, null, 2);
            } catch (e) {
                el.className = 'result error';
                el.textContent = 'âŒ Gateway è®¿é—®å¤±è´¥: ' + e.message + '\n\nå¯èƒ½æ˜¯ CORS é—®é¢˜ï¼Œè¯·åœ¨æµè§ˆå™¨åœ°å€æ ç›´æ¥è®¿é—®ï¼š\nhttp://localhost:8080/film/recommend/feed?size=3';
            }
        }
        
        function clearStorage() {
            const el = document.getElementById('result7');
            localStorage.clear();
            sessionStorage.clear();
            savedToken = null;
            el.className = 'result success';
            el.textContent = 'âœ… å·²æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨ï¼\n\nè¯·åˆ·æ–°é¡µé¢åé‡æ–°æµ‹è¯•ã€‚';
        }
    </script>
</body>
</html>
